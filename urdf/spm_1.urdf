<?xml version="1.0"?>
<robot name="week_3" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="pi" value="3.141592" />
    <xacro:property name="c120" value="-0.5" />
    <xacro:property name="s120" value="0.866025404" />
    <xacro:property name="c45" value="0.707106781" />
    <xacro:property name="s45" value="0.707106781" />
    <xacro:property name="c90" value="0" />
    <xacro:property name="s90" value="1" />
    <xacro:property name="c22" value="0.923879533" />
    <xacro:property name="s22" value="0.382683432" />


<xacro:macro name="arm_assembly" params="name parent *origin">
  
  <joint name="${name}" type="fixed" >
    <parent link="${parent}"/>
    <child link="${name}_motor"/>
    <xacro:insert_block name="origin"/>
    <axis xyz=" 0 0 0"/>
  </joint>



<link name="${name}_motor">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0 "/>
      <geometry>
         <mesh filename="package://robot/meshes/motor.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="motor">
        <color rgba="${192/255} ${192/255} ${192/255} 1.0"/>
      </material>
    </visual>
    <collision>
     <origin xyz="0 0.14479 0.05685" rpy=" ${-112.5*pi/180} 0 0"/>
     <geometry>
     <cylinder length="0.034" radius="0.016"/>
     </geometry>
     <material name="orange_collision">
       <color rgba="${255/255} ${153/255} ${51/255} 1.0"/>
     </material>
    </collision>
  <inertial>
    <mass value="0.1"/>
    <inertia ixx="0.00000442" ixy="0" ixz="0" iyy="0.00000442" iyz="0" izz="0.00000063"/>
  </inertial>
  </link>

  <joint name="${name}_stepper_motor_to_motor_axis" type="fixed">
    <parent link="${name}_motor"/>
    <child link="${name}_motor_axis"/>
    <axis xyz="0 0 1" />
    <origin rpy= "${-112.5*pi/180} 0 0" xyz="0 0.12909 0.06335" />
  </joint>

   <link name="${name}_motor_axis">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
         <mesh filename="package://robot/meshes/eix_motor.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="motor">
        <color rgba="${192/255} ${192/255} ${192/255} 1.0"/>
      </material>
    </visual>
    <collision>
     <origin xyz="0 0 -0.00439 " rpy=" 0 0 0"/>
     <geometry>
     <cylinder length="0.01" radius="0.0015"/>
     </geometry>
     <material name="orange_collision">
     </material>
    </collision>
  <inertial>
    <mass value="0.010"/>
    <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0"/>
  </inertial>    
  </link>

    <joint name="${name}_motor_axis_to_arm_1" type="revolute">
    <parent link="${name}_motor_axis"/>
    <child link="${name}_arm_1"/>
    <axis xyz="0 0 1" />
    <origin rpy= "0 0 0" xyz="0 0 0" />
    <limit effort="100000" lower="${-45*pi/180}" upper="${45*pi/180}" velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/> 
  </joint> 
 

<link name="${name}_arm_1">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/inferior_arm.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="arm_1">
        <color rgba="${255/255} ${153/255} ${51/255} 1.0"/>
     </material>
    </visual>
     <collision>
      <geometry>
        <mesh filename="package://robot/meshes/inferior_arm.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="orange_collision">
     </material>
    </collision>
    <inertial>
      <mass value="0.025"/>
      <inertia ixx="0.00000384" ixy="0" ixz="0.00000566" iyy="0.00002011" iyz="0" izz="0.00001923"/>
    </inertial>
  </link> 

<joint name="${name}_arm_1_to_arm_2" type="revolute">
    <parent link="${name}_arm_1"/>
    <child link="${name}_arm_2"/>
    <axis xyz="0 0 1"/>
    <origin xyz="0 -0.05327 -0.01067" rpy= "${22.5*pi/180} 0 0"/>
    <limit effort="100000" lower="${-45*pi/180}" upper="${45*pi/180}" velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/> 
  </joint>


   <link name="${name}_arm_2">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/as.stl" scale="0.001 0.001 0.001"/>
      </geometry>
          <material name="arm_2">
        <color rgba="${150/255} ${150/255} ${50/255} 1.0"/>
     </material>
    </visual>
         <collision>
      <geometry>
        <mesh filename="package://robot/meshes/as.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
    <material 
        name="orange_collision">
     </material>
    <inertial>
      <mass value="0.025"/>
      <inertia ixx="0.00001720" ixy="0" ixz="0" iyy="0.00000114" iyz="0.00000039" izz="0.00001736"/>
    </inertial>
  </link>

   <joint name="${name}_arm_2_to_axis_arm_2" type="revolute">
    <parent link="${name}_arm_2"/>
    <child link="${name}_axis_arm_2"/>
    <axis xyz="0 0 1"/>
    <origin rpy= "${22.5*pi/180} 0 0" xyz="0 -0.05327 -0.01067" />
    <limit effort="100000" lower="${-45*pi/180}" upper="${45*pi/180}" velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>

     <link name="${name}_axis_arm_2">
        <visual>
          <geometry>
            <cylinder length="0.01" radius="0.002"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 0"/>
      <material name="arm_2"/>
        </visual>
      <collision>
        <origin xyz="0 0 -0.00439" rpy=" 0 0 0"/>
        <geometry>
        <cylinder length="0.01" radius="0.0015"/>
        </geometry>
        <material name="orange_collision">
        </material>
      </collision>
  <inertial>
    <mass value="0.010"/>
    <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0"/>
  </inertial>
      </link>

      </xacro:macro>

 
 <!-- CODI RODES -->

 <xacro:macro name="wheel_assembly" params="name parent *origin">

  <joint name="${name}" type="fixed" >  <!-- sempre ha d'esser fixed en una xacro el primer link?-->
    <parent link="${parent}"/>
    <child link="${name}_centre_esfera"/>
    <xacro:insert_block name="origin"/>
    <axis xyz=" 0 0 0"/>
  </joint>

  <link name="${name}_centre_esfera" >
    <visual>
     <origin xyz="0 0 0" rpy="0 0 0 "/>
     <geometry>
       <mesh filename="package://robot/meshes/centre_esfera.stl" scale="0.001 0.001 0.001"/>
     </geometry>
    <material name="Cyan">
       <color rgba="0 1.0 1.0 1.0"/>
     </material>
   </visual>
   <collision>
     <origin xyz="0 0 0" rpy="0 0 0"/>
     <geometry>
       <mesh filename="package://robot/meshes/centre_esfera.stl" scale="0.001 0.001 0.001"/>
     </geometry>
      <material name="orange_collision">
     </material>
   </collision>
   <inertial>
      <mass value="0.000510"/>
      <inertia ixx="0" ixy="0" ixz="0" iyy="0." iyz="0" izz="0"/>
    </inertial>
</link>  

  <joint name="${name}_centre_esfera_to_esfera_eix_2" type="continuous" >
    <parent link="${name}_centre_esfera"/>
    <child link="${name}_esfera_eix_2"/>
    <axis xyz=" 0 1 0"/>
    <origin rpy= "0 0 0" xyz="0 -0.15 0.05"/>
  </joint>


  <link name="${name}_esfera_eix_2" >
    <visual>
     <origin xyz="0 0 0" rpy="0 0 0" />
     <geometry>
       <mesh filename="package://robot/meshes/centre_esfera_02.stl" scale="0.001 0.001 0.001"/>
     </geometry>
 <material name="arm_1">
       <color rgba="0 1.0 1.0 1.0"/>
     </material>
   </visual>
   <collision>
     <origin xyz="0 0 0" rpy="0 0 0"/>
     <geometry>
       <mesh filename="package://robot/meshes/centre_esfera_02.stl" scale="0.001 0.001 0.001"/>
     </geometry>
   </collision>
     <material name="orange_collision">
     </material>
   <inertial>
      <mass value="0.000510"/>
      <inertia ixx="0" ixy="0" ixz="0" iyy="0." iyz="0" izz="0"/>
    </inertial>
</link>  

  <joint name="${name}_esfera_eix_2_to_esfera" type="continuous" >
    <parent link="${name}_esfera_eix_2"/>
    <child link="${name}_esfera"/>
    <axis xyz=" 1 0 0"/>
    <origin rpy= "0 0 0" xyz="0 0 0" />
  </joint>

<link name="${name}_esfera">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/esfera.stl" scale="0.001 0.001 0.001"/>
      </geometry>
          <material name="arm_1">
        <color rgba="${150/255} ${150/255} ${50/255} 1.0"/>
     </material>
    </visual>
         <collision>
      <geometry>
        <mesh filename="package://robot/meshes/esfera.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
    <material name="orange_collision">
     </material>
    <inertial>
      <mass value="0.2"/>
      <inertia ixx="0.00672201" ixy="0" ixz="0" iyy="0.00136756" iyz="0.00175517" izz="0.00591035"/>
    </inertial>
  </link>


<!-- CODI RODES -->

</xacro:macro>


<link name="base"/>

<xacro:arm_assembly name="ARM_ONE" parent="base">
  <origin xyz="0 0 0" rpy="0 0 0"/>
</xacro:arm_assembly>
<xacro:arm_assembly name="ARM_TWO" parent="base">
  <origin xyz="0 0 0" rpy="0 0 ${120*pi/180}"/>
</xacro:arm_assembly>
<xacro:arm_assembly name="ARM_THREE" parent="base">
  <origin xyz="0 0 0" rpy="0 0 ${-120*pi/180}"/>
</xacro:arm_assembly>

<xacro:wheel_assembly name="WHEEL_ONE" parent="base">
  <origin xyz="0 0 0" rpy="0 0 0"/>
</xacro:wheel_assembly>
<xacro:wheel_assembly name="WHEEL_TWO" parent="base">
  <origin xyz="0 0 0" rpy="0 0 ${120*pi/180}"/>
</xacro:wheel_assembly>
<xacro:wheel_assembly name="WHEEL_THREE" parent="base">
  <origin xyz="0 0 0" rpy="0 0 ${-120*pi/180}"/>
</xacro:wheel_assembly>


<!-- COMENTAR-HO -->

   <joint name="plat_superior_joint_arm_one" type="revolute">
     <parent link="ARM_ONE_axis_arm_2"/>
     <child link="plat_superior"/>
     <axis xyz="0 0 1 "/>
     <origin xyz="0 0 -${s22*0.37}" rpy= "${67.5*pi/180} 0 0"/>
     <limit effort="100000" lower="${-45*pi/180}" upper="${45*pi/180}" velocity="${2*pi}"/>
     <dynamics friction="0.01" damping="0.001"/>
    </joint> 

   <joint name="plat_superior_joint_arm_two" type="revolute">
     <parent link="ARM_TWO_axis_arm_2"/>
     <child link="plat_superior"/>
     <axis xyz="0 0 1 "/>
     <origin xyz="0 0 -${s22*0.37}" rpy= "${67.5*pi/180} 0 0"/>
     <limit effort="100000" lower="${-45*pi/180}" upper="${45*pi/180}" velocity="${2*pi}"/>
     <dynamics friction="0.01" damping="0.001"/>
    </joint>

    <joint name="plat_superior_joint_arm_three" type="revolute">
     <parent link="ARM_THREE_axis_arm_2"/>
     <child link="plat_superior"/>
     <axis xyz="0 0 1 "/>
     <origin xyz="0 0 -${s22*0.37}" rpy= "${67.5*pi/180} 0 0"/>
     <limit effort="100000" lower="${-45*pi/180}" upper="${45*pi/180}" velocity="${2*pi}"/>
     <dynamics friction="0.01" damping="0.001"/>
    </joint>


<link name="plat_superior">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/plat_superior.stl" scale="0.001 0.001 0.001"/>
      </geometry>
          <material name="arm_1">
        <color rgba="${150/255} ${150/255} ${50/255} 1.0"/>
     </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.037" rpy="0 0 0" />
      <geometry>
        <cylinder length="0.050" radius="0.125"/>
      </geometry>
    </collision>
    <material name="arm_1">
     </material>
    <inertial>
        <mass value="0.0679"/>
      <inertia ixx="0.00035045" ixy="0" ixz="0" iyy="0.00035046" iyz="0" izz="0.00041102"/>
    </inertial>
  </link> 


</robot>