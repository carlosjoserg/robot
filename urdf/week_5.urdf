<?xml version="1.0"?>
<robot name="robot" xmlns:xacro="http://www.ros.org/wiki/xacro">


  <xacro:property name="pi" value="3.141592" />
    <xacro:property name="c120" value="-0.5" />
    <xacro:property name="s120" value="0.866025404" />
    <xacro:property name="c45" value="0.707106781" />
    <xacro:property name="s45" value="0.707106781" />
    <xacro:property name="c90" value="0" />
    <xacro:property name="s90" value="1" />


<xacro:macro name="omniwheel" params="name parent *origin">
  <joint name="${name}" type="continuous" >
    <parent link="${parent}"/>
    <child link="${name}_frame"/>
    <xacro:insert_block name="origin"/>
    <axis xyz="1 0 0"/>
    <limit effort="100000." velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>

<transmission name="${name}_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


    <link name="${name}_frame">
    <visual>
      <origin  xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/omniwheel.stl"/>
      </geometry>
      <material name="gris_llanta">
        <color rgba="${192/255} ${192/255} ${192/255} 1.0"/>
      </material>
    </visual>
     <collision>
           <origin xyz="0 0 0" rpy=" 0 ${0.5*pi} 0"/>   <!-- el disc de colisio surt inclinat -->
       <geometry>
         <cylinder length="0.01" radius="0.03"/>
       </geometry>
       <material name="orange_collision">
        <color rgba="${255/255} ${153/255} ${51/255} 1.0"/>
     </material>
    </collision>
     <inertial>
      <mass value="0.039"/>
      <inertia ixx="0.00007188" ixy="0" ixz="0" iyy="0.00003634" iyz="0" izz="0.00003634"/>
     </inertial>
  </link>


 <transmission name="${name}_rodeta_1_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_1_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_1_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_1_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_1"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 0 ${0.0525}" rpy="0 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_1">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
        <color rgba="${96/255} ${96/255} ${96/255} 1.0"/>
      </material>
    </visual>
     <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_2_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_2_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_2_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_2_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_2"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${c45*0.0525} ${s45*0.0525}" rpy="${-45*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_2">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_3_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_3_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_3_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_3_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_3"/>
    <axis xyz="0 1 0"/>
    <origin xyz="${c90*0.0525} ${s90*0.0525} 0" rpy=" ${90*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_3">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
        <color rgba="${0/255} ${108/255} ${0/255} 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_4_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_4_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_4_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


<joint name="${name}_rodeta_4_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_4"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${s45*0.0525} ${-c45*0.0525}" rpy="${-135*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_4">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_5_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_5_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_5_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_5_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_5"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 0 ${-0.0525}" rpy="0 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_5">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_6_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_6_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_6_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


<joint name="${name}_rodeta_6_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_6"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${-s45*0.0525} ${-c45*0.0525}" rpy="${135*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_6">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>



   <transmission name="${name}_rodeta_7_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_7_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_7_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

 <joint name="${name}_rodeta_7_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_7"/>
    <axis xyz="0 1 0"/>
    <origin xyz="${c90*0.0525} ${-s90*0.0525} 0" rpy=" ${-90*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_7">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>



 <transmission name="${name}_rodeta_8_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_8_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_8_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


    <joint name="${name}_rodeta_8_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_8"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${-c45*0.0525} ${s45*0.0525}" rpy="${45*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_8">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000075" ixy="0" ixz="0" iyy="0.00000037" iyz="0" izz="0.00000075"/>
    </inertial>
  </link>


</xacro:macro>


<link name="base"> 
      <visual>
      <origin xyz="0 0 0" rpy=" 0 0 ${2*pi/3}"/>
      <geometry>
        <mesh filename="package://robot/meshes/main_body.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.11" radius="0.225"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.42"/>
      <inertia ixx="0.00639893" ixy="0.00000012" ixz="0.00000025" iyy="0.00640057" iyz="-0.00000020" izz="0.01187067"/>
    </inertial>
</link>

<xacro:omniwheel name="MY_WHEEL_ONE" parent="base">
  <origin xyz="0.238 0 0" rpy="0 0 0" />
</xacro:omniwheel>
<xacro:omniwheel name="MY_WHEEL_TWO" parent="base">
  <origin xyz="${0.238*c120} ${0.238*s120} 0" rpy="0 0 ${120*pi/180}"/>
</xacro:omniwheel>
<xacro:omniwheel name="MY_WHEEL_THREE" parent="base">
  <origin xyz="${0.238*c120} ${-1*0.238*s120} 0" rpy="0 0 ${-120*pi/180}"/>
</xacro:omniwheel>


<!-- MODIFICACIONS URDF PROPELLERS, MOTORS I PLATAFORMA -->


<transmission name="rev1_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="rev1">
    <hardwareInterface>PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="rev1_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<joint name="rev1" type="revolute" >
    <parent link="base"/>
    <child link="fake_link"/>
    <axis xyz="1 0 0"/>
    <origin xyz="0 0 0.07024" rpy="0 0 ${90*pi/180}"/>
    <!--origin xyz="0 0 0" rpy="0 0 ${90*pi/180}"/-->
    <limit effort="100000" lower="${-35*pi/180}" upper="${35*pi/180}" velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/>
</joint>

<link name="fake_link" >
    <visual>
     <origin xyz="0 0 0" rpy="0 0 0" />
     <geometry>
       <mesh filename="package://robot/meshes/fake_0_0.stl"/>
     </geometry>
 <material name="Cyan">
       <color rgba="0 1.0 1.0 1.0"/>
     </material>
   </visual>
   <collision>
     <origin xyz="0 0 0.07024" rpy="0 0 0"/>
     <geometry>
       <mesh filename="package://robot/meshes/fake_0_0.stl" />
     </geometry>
   </collision>
   <inertial>
      <mass value="0.000014"/>
      <inertia ixx="0" ixy="0" ixz="0" iyy="0." iyz="0" izz="0"/>
    </inertial>
</link>

<transmission name="rev2_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="rev2">
    <hardwareInterface>PositionJointInterface</hardwareInterface>
  </joint>
  <actuator name="rev2_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

<joint name="rev2" type="revolute" >
    <parent link="fake_link"/>
    <child link="motor_frame"/>
    <origin xyz="0 0 0" rpy="0 0 1 "/>
    <axis xyz="0 1 0"/>
    <limit effort="100000." lower="${-35*pi/180}" upper="${35*pi/180}" velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/>
</joint>


<link name="motor_frame" > <!-- plat superior i els dos motors -->
    <visual>
      <origin xyz="0 0 0" rpy="0 0 ${pi-pi/6.5}" />
      <geometry>
        <mesh filename="package://robot/meshes/plat_superior_0_0_0.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <cylinder length="0.035" radius="0.125"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.094"/>
      <inertia ixx="0.00035408" ixy="0" ixz="0.00000002" iyy="0.00035399" iyz="0" izz="0.00041431"/>
    </inertial>
</link>



<transmission name="top_propeller_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="top_propeller">
    <hardwareInterface>VelocityJointInterface</hardwareInterface>
  </joint>
  <actuator name="top_propeller_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


    <joint name="top_propeller" type="continuous">
    <parent link="motor_frame"/>
    <child link="top_propeller"/>
    <axis xyz="0 0 1"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <limit effort="999999" velocity="${1000*pi}"/>
  </joint>

  <link name="top_propeller">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/top_propeller_0_0_0.stl"/>
      </geometry>
        <material name="gris_llanta">
        <color rgba="${192/255} ${192/255} ${192/255} 1.0"/>
      </material>
    </visual>
    <collision>
        <origin xyz="0 0 0.07" rpy="0 0 0"/>
     <geometry>
       <cylinder radius="0.125" length="0.01"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.0078"/>
      <inertia ixx="0.00003179" ixy="0.00000012" ixz="0" iyy="0.00000014" iyz="0" izz="0.00003186"/>
    </inertial>
  </link>


<transmission name="bottom_propeller_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="bottom_propeller">
    <hardwareInterface>VelocityJointInterface</hardwareInterface>
  </joint>
  <actuator name="bottom_propeller_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="bottom_propeller" type="continuous">
    <parent link="motor_frame"/>
    <child link="bottom_propeller"/>
    <axis xyz="0 0 1"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <limit effort="999999" velocity="${1000*pi}"/>
    <dynamics friction="0.001" damping="0.0001"/>
  </joint>

  <link name="bottom_propeller">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/bottom_propeller_0_0_0.stl"/>
      </geometry>
        <material name="gris_llanta">
        <color rgba="${192/255} ${192/255} ${192/255} 1.0"/>
      </material>
    </visual>
    <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
     <geometry>
       <cylinder radius="0.125" length="0.01"/>
       <color rgba="${255/255} ${153/255} ${51/255} 1.0"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.0078"/>
      <inertia ixx="0.00003179" ixy="0.00000012" ixz="0" iyy="0.00000014" iyz="0" izz="0.00003186"/>
    </inertial>
</link>

<gazebo>
  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
    <robotNamespace>/robot</robotNamespace>
  </plugin>

    <!-- plugin to simulate the lift force by the helix -->
    <!--
      link_name: Name of the link affected by the group of lift/drag properties.
      air_density: Density of the fluid this model is suspended in.
      area: Surface area of the link.
      a0: The initial "alpha" or initial angle of attack. a0 is also the y-intercept of the alpha-lift coefficient curve.
      cla: The ratio of the coefficient of lift and alpha slope before stall. Slope of the first portion of the alpha-lift coefficient curve.
      cda: The ratio of the coefficient of drag and alpha slope before stall.
      cp: Center of pressure. The forces due to lift and drag will be applied here.
      forward: 3-vector representing the forward direction of motion in the link frame.
      upward: 3-vector representing the direction of lift or drag.
      alpha_stall: Angle of attack at stall point; the peak angle of attack.
      cla_stall: The ratio of coefficient of lift and alpha slope after stall. Slope of the second portion of the alpha-lift coefficient curve.
      cda_stall: The ratio of coefficient of drag and alpha slope after stall.
    -->
    <plugin name="top_propeller_1" filename="libLiftDragPlugin.so">
      <a0>0.3</a0>
      <cla>4.752798721</cla>
      <cda>0.6417112299</cda>
      <alpha_stall>1.3</alpha_stall>
      <cla_stall>-3.85</cla_stall>
      <cda_stall>-0.9233984055</cda_stall>
      <cp>0 0.012 0.15</cp>
      <area>0.005</area>
      <air_density>1.2041</air_density>
      <forward>-0.96 0 0.28</forward>
      <upward>0.28 0 0.96</upward>
      <link_name>top_propeller</link_name>
    </plugin>

    <plugin name="top_propeller_2" filename="libLiftDragPlugin.so">
      <a0>0.3</a0>
      <cla>4.752798721</cla>
      <cda>0.6417112299</cda>
      <alpha_stall>1.3</alpha_stall>
      <cla_stall>-3.85</cla_stall>
      <cda_stall>-0.9233984055</cda_stall>
      <cp>0 -0.012 0.15</cp>
      <area>0.005</area>
      <air_density>1.2041</air_density>
      <forward>0.96 0 0.28</forward>
      <upward>-0.28 0 0.96</upward>
      <link_name>top_propeller</link_name>
    </plugin>

    <!-- plugin name="bottom_propeller_1" filename="libLiftDragPlugin.so">
      <a0>0.3</a0>
      <cla>4.752798721</cla>
      <cda>0.6417112299</cda>
      <alpha_stall>1.3</alpha_stall>
      <cla_stall>-3.85</cla_stall>
      <cda_stall>-0.9233984055</cda_stall>
      <cp>0 0.012 0.005</cp>
      <area>0.00125</area>
      <air_density>1.2041</air_density>
      <forward>1 0 0</forward>
      <upward>0 0 1</upward>
      <link_name>bottom_propeller</link_name>
    </plugin>

      <plugin name="bottom_propeller_2" filename="libLiftDragPlugin.so">
        <a0>0.3</a0>
        <cla>4.752798721</cla>
        <cda>0.6417112299</cda>
        <alpha_stall>1.3</alpha_stall>
        <cla_stall>-3.85</cla_stall>
        <cda_stall>-0.9233984055</cda_stall>
        <cp>0 -0.012 0.005</cp>
        <area>0.00125</area>
        <air_density>1.2041</air_density>
	<forward>-1 0 0</forward>
        <upward>0 0 1</upward>
        <link_name>bottom_propeller</link_name>
     </plugin -->

</gazebo>


</robot>
