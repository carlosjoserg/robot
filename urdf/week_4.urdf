<?xml version="1.0"?>
<robot name="robot" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="pi" value="3.141592" />
    <xacro:property name="c120" value="-0.5" />
    <xacro:property name="s120" value="0.866025404" />
    <xacro:property name="c45" value="0.707106781" />
    <xacro:property name="s45" value="0.707106781" />
    <xacro:property name="c90" value="0" />
    <xacro:property name="s90" value="1" />


<xacro:macro name="omniwheel" params="name parent *origin">
  <joint name="${name}" type="continuous" >
    <parent link="${parent}"/>
    <child link="${name}_frame"/>
    <xacro:insert_block name="origin"/>
    <axis xyz="1 0 0"/>
    <limit effort="100000." velocity="${2*pi}"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>

<transmission name="${name}_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


    <link name="${name}_frame">
    <visual>
      <origin  xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/omniwheel.stl"/>
      </geometry>
      <material name="gris_llanta">
        <color rgba="${192/255} ${192/255} ${192/255} 1.0"/>
      </material>
    </visual>
     <collision>
           <origin xyz="0 0 0" rpy=" 0 ${0.5*pi} 0"/>   <!-- el disc de colisio surt inclinat -->    
       <geometry>
         <cylinder length="0.01" radius="0.03"/>
       </geometry>
       <material name="orange_collision">
        <color rgba="${255/255} ${153/255} ${51/255} 1.0"/>
     </material>
    </collision>
     <inertial>
      <mass value="0.039"/>
      <inertia ixx="0.00029575" ixy="0.00051079" ixz="-0.00034733" iyy="0.00181141" iyz="-0.00010410" izz="0.00189371"/>
     </inertial>
  </link>


 <transmission name="${name}_rodeta_1_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_1_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_1_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_1_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_1"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 0 ${0.0525}" rpy="0 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_1">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
        <color rgba="${96/255} ${96/255} ${96/255} 1.0"/>
      </material>
    </visual>
     <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_2_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_2_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_2_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_2_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_2"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${c45*0.0525} ${s45*0.0525}" rpy="${-45*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_2">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_3_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_3_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_3_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_3_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_3"/>
    <axis xyz="0 1 0"/>
    <origin xyz="${c90*0.0525} ${s90*0.0525} 0" rpy=" ${90*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_3">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
        <color rgba="${0/255} ${108/255} ${0/255} 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_4_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_4_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_4_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


<joint name="${name}_rodeta_4_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_4"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${s45*0.0525} ${-c45*0.0525}" rpy="${-135*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_4">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_5_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_5_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_5_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

  <joint name="${name}_rodeta_5_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_5"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 0 ${-0.0525}" rpy="0 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_5">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>


 <transmission name="${name}_rodeta_6_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_6_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_6_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


<joint name="${name}_rodeta_6_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_6"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${-s45*0.0525} ${-c45*0.0525}" rpy="${135*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_6">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>



   <transmission name="${name}_rodeta_7_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_7_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_7_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>

 <joint name="${name}_rodeta_7_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_7"/>
    <axis xyz="0 1 0"/>
    <origin xyz="${c90*0.0525} ${-s90*0.0525} 0" rpy=" ${-90*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_7">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>



 <transmission name="${name}_rodeta_8_joint_trans">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="${name}_rodeta_8_joint">
    <hardwareInterface>EffortJointInterface</hardwareInterface>
  </joint>
  <actuator name="${name}_rodeta_8_joint_motor">
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>


    <joint name="${name}_rodeta_8_joint" type="continuous">
    <parent link="${name}_frame"/>
    <child link="${name}_rodeta_8"/>
    <axis xyz="0 1 0"/>
    <origin xyz="0 ${-c45*0.0525} ${s45*0.0525}" rpy="${45*pi/180} 0 0"/>
    <dynamics friction="0.01" damping="0.001"/>
  </joint>
  <link name="${name}_rodeta_8">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://robot/meshes/rodeta.stl"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.008"/>
      <inertia ixx="0.00000635" ixy="0.00004420" ixz="-0.00000937" iyy="0.00036482" iyz="-0.00000095" izz="0.00036995"/>
    </inertial>
  </link>


</xacro:macro>


<link name="base">  <!-- S'HA DE CANVIAR PEL COS DEL ROBOT -->
      <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://robot/meshes/main_body.stl"/>
      </geometry>
      <material name="gris_rodeta">
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.11" radius="0.225"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.42"/>
      <inertia ixx="0.00804080" ixy="0.00000103" ixz="0.00000122" iyy="0.01183327" iyz="-0.00000256" izz="0.00804052"/>
    </inertial>
</link>

<xacro:omniwheel name="MY_WHEEL_ONE" parent="base">
  <origin xyz="0.238 0 0" rpy="0 0 0" />
</xacro:omniwheel>
<xacro:omniwheel name="MY_WHEEL_TWO" parent="base">
  <origin xyz="${0.238*c120} ${0.238*s120} 0" rpy="0 0 ${120*pi/180}"/>
</xacro:omniwheel>
<xacro:omniwheel name="MY_WHEEL_THREE" parent="base">
  <origin xyz="${0.238*c120} ${-1*0.238*s120} 0" rpy="0 0 ${-120*pi/180}"/>
</xacro:omniwheel>

<gazebo>
  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
    <robotNamespace>/robot</robotNamespace>
  </plugin>
</gazebo>


</robot>